<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scrolly</title>
</head>

<body>

    <!-- START SCROLLY -->

    <div class="scrolly">
        <style>
            @font-face {
                font-family: 'Balto';
                src: url('fonts/Balto-Book.woff') format('woff');
                font-weight: 400;
                font-style: normal;
            }

            @font-face {
                font-family: 'Balto';
                src: url('fonts/Balto-Bold.woff') format('woff');
                font-weight: 700;
                font-style: normal;
            }

            @font-face {
                font-family: 'Balto';
                src: url('fonts/Balto-Medium.woff') format('woff');
                font-weight: 500;
                font-style: normal;
            }

            @font-face {
                font-family: 'Balto';
                src: url('fonts/Balto-MediumItalic.woff') format('woff');
                font-weight: 500;
                font-style: italic;
            }

            .scrolly {
                width: 100%;
                position: relative;
            }

            .scrolly * {
                box-sizing: border-box;
                font-family: 'Balto', sans-serif;
            }

            .scrolly-bg {
                position: absolute;
                top: 0;
                left: 0;
                z-index: -1;
                width: 100%;
                height: 100%;
            }

            .scrolly-indicator {
                position: fixed;
                top: 0;
                right: 0;
            }


            .scrolly .scrolly-sections-container,
            .scrolly .scrolly-sections-container * {
                pointer-events: none;
            }

            .scrolly .scrolly-section {
                height: 100vh;
                display: flex;
                justify-content: center;
                align-items: center;
                transition: background-color 0.5s ease;
                position: relative;
            }

            .scrolly .scrolly-section.debug {
                outline: 1px solid red;
            }

            .scrolly .scrolly-section-label {
                position: absolute;
                top: 0;
                left: 0;
                padding: 0.5em;
                background-color: #000;
                color: #fff;
                font-size: 0.5em;
                font-weight: bold;
            }

            .scrolly .scrolly-background {
                position: absolute;
                top: 50vh;
                left: 50%;
                transform: translate(-50%, -50%);
                width: 1000px;
                max-width: 100%;
                aspect-ratio: 16 / 16;
                z-index: -1;
                overflow: hidden;
            }

            .scrolly .scrolly-annotations {
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                width: 100%;
                height: 100%;
                z-index: 3;
            }

            .scrolly-annotation {
                position: absolute;
            }

            .scrolly .scrolly-background.fixed {
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
            }

            .scrolly .scrolly-bg-image {
                width: 100%;
                height: 100%;
                object-fit: cover;
                transform-origin: center center;
            }

            .scrolly .scrolly-slide-inner {
                width: 1000px;
                max-width: 100%;
                display: inline-block;
                padding: 0 2em;
            }

            .scrolly .scrolly-row {
                display: flex;
                width: 100%;
            }

            .scrolly .scrolly-col {
                flex: 1;
                max-width: 33%;
                padding: 0 15px;

            }

            .scrolly .scrolly-row-2-up .scrolly-col {
                max-width: 50% !important
            }

            /* MARGINS AND PADDING */

            .scrolly .scrolly-mt-1 {
                margin-top: 1em;
            }

            .scrolly .scrolly-mt-2 {
                margin-top: 2em;
            }

            .scrolly .scrolly-mt-3 {
                margin-top: 3em;
            }

            .scrolly .scrolly-mt-4 {
                margin-top: 4em;
            }

            .scrolly .scrolly-mt-5 {
                margin-top: 5em;
            }

            .scrolly .scrolly-mb-1 {
                margin-bottom: 1em;
            }

            .scrolly .scrolly-mb-2 {
                margin-bottom: 2em;
            }

            .scrolly .scrolly-mb-3 {
                margin-bottom: 3em;
            }

            .scrolly .scrolly-mb-4 {
                margin-bottom: 4em;
            }

            .scrolly .scrolly-mb-5 {
                margin-bottom: 5em;
            }

            /* CUSTOMISATION STARTS HERE */

            .scrolly .scrolly-chart-container {
                width: 100%;
                height: 100%;
                position: relative;
            }

            .scrolly .scrolly-chart-container canvas {
                pointer-events: auto;
            }

            .scrolly .scrolly-chart-legend-container {
                text-align: center;
            }

            .scrolly .scrolly-chart-title-container {
                text-align: center;
            }

            .scrolly .scrolly-chart-title {
                background-color: #000;
                padding: 0.5em 1em;
                text-align: center;
                display: inline-block;
                font-size: 1em;
                font-weight: 500;
                color: #fff;
            }

            .scrolly .scrolly-chart-legend {
                text-align: center;
                display: inline-block;
                background-color: #000;
                padding: 0.5em 1em;
            }

            .scrolly .scrolly-legend-item {
                display: inline-block;
            }

            .scrolly .scrolly-legend-color {
                width: 0.9em;
                height: 0.9em;
                display: inline-block;
                margin-right: 4px;
                border-radius: 2px;
                position: relative;
                top: 3px;
            }

            .scrolly .scrolly-legend-text {
                display: inline-block;
                font-size: 0.8em;
                margin-right: 1em;
                color: #fff;
            }

            .scrolly .scrolly-chart-label-container {
                text-align: center;
            }

            .scrolly .scrolly-chart-label {
                display: inline-block;
                text-align: center;
                font-size: 0.7em;
                margin-top: 1em;
                background-color: #000;
                color: #fff;
                padding: 0.5em 1em;
            }


            .scrolly .scrolly-background {
                border: 1px solid #eee;
            }

            .scrolly {
                font-family: 'Balto', sans-serif;
                font-size: 16px;
            }

            .scrolly h1 {
                font-size: 1.5em;
                margin: unset;
                margin-bottom: 0.8em;
                padding: unset;
                font-weight: 500;
                line-height: unset;
            }

            .scrolly .scrolly-primary {
                color: #F45946;
            }

            .scrolly .scrolly-secondary {
                color: #FFC107;
            }

            .scrolly .scrolly-fw-500 {
                font-weight: 500;
            }

            .scrolly .scrolly-big {
                font-size: 1.5em;
            }

            .scrolly p {
                line-height: 1.2em;
            }

            .scrolly p:first-child {
                margin-top: 0;
            }

            .scrolly p:last-child {
                margin-bottom: 0;
            }

            

            .scrolly-caption-box {
                color: #fff;
                padding: 1em;
                max-width: 500px;
                text-align: left;
            }

            .scrolly-caption-box-overlay {
                background-color: rgba(0, 0, 0, 0.7);
                border-radius: 5px;
            }

            /* ANNOTATIONS */

            .scrolly .scrolly-annotation-label {
                background-color: #F45946;
                color: #fff;
                font-family: 'Courier New', Courier, monospace;
                padding: 0.1em 1em;
                font-size: 0.8em;
                font-weight: bold;
                box-shadow: 0 0 3px rgba(0, 0, 0, 0.8);
                text-align: center;
            }


            .scrolly-annotation-fs {
                top: 53%;
                right: 22%;
            }

            .scrolly-annotation-kzn {
                top: 60%;
                right: 12%;
            }

            .scrolly-annotation-lp {
                top: 30%;
                right: 15%;
            }

            /* CHARTS */

            .scrolly-chart-1, .scrolly-chart-2, .scrolly-chart-3 {
                width: 100%;
                height: 100%;
                top: 0;
                left: 0;
            }

            .scrolly-chart-1 .scrolly-annotation-inner, .scrolly-chart-2 .scrolly-annotation-inner, .scrolly-chart-3 .scrolly-annotation-inner {
                width: 600px;
                max-width: 80%;
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -30%);
            }

            .scrolly-chart-3 .scrolly-annotation-inner {
                width: 700px;
                transform: translate(-50%, -25%);
            }

            .scrolly-chart-1 .scrolly-caption-box, .scrolly-chart-2 .scrolly-caption-box, .scrolly-chart-3 .scrolly-caption-box {
                position: absolute;
                top: 2em;
                left: 2em;
            }

            


            /* RESPONSIVENESS */

            @media (min-width: 768px) {

                .scrolly {
                    font-size: 22px;
                }

                .scrolly .scrolly-background {
                    aspect-ratio: 16 / 9;
                }

                .scrolly .scrolly-legend-text {
                    font-size: 0.7em;
                }



            }


        </style>

        <div class="scrolly-indicator"></div>

        <div class="scrolly-bg-color"></div>

        <div class="scrolly-background">
            <img src="img/toilets1.jpg" alt="Background Image" class="scrolly-bg-image">
            <div class="scrolly-annotations">
               

                <div class="scrolly-annotation scrolly-chart-1">

                    <div class="scrolly-caption-box" data-annotation-label="outdoor-facilities" style="opacity: 0">
                        <p>Many clinics in Limpopo and KZN rely on <span class="scrolly-secondary scrolly-fw-500 scrolly-big">outdoor facilities</span>.</p>
                    </div>

                    <div class="scrolly-caption-box" data-annotation-label="disabled-access" style="opacity: 0">
                        <p>But while all the clinics we visited in the <span class="scrolly-secondary scrolly-fw-500">Free State</span> had bathrooms inside the clinics, they were also the <span class="scrolly-secondary scrolly-fw-500 scrolly-big">least accessible to patients with a disability</span>.</p>
                    </div>

                    <div class="scrolly-caption-box" data-annotation-label="broken-toilets" style="opacity: 0">
                        <p><span class="scrolly-secondary scrolly-fw-500 scrolly-big">75.4%</span> of people we spoke to said that at some point, <span class="scrolly-secondary scrolly-fw-500 scrolly-big">the toilets had been out of order</span> when then visited the clinic.</p>
                    </div>

                    <div class="scrolly-caption-box" data-annotation-label="not-stocked" style="opacity: 0">
                        <p>Even when patients could visit the bathroom, however, both male and female toilets were <span class="scrolly-secondary scrolly-fw-500 scrolly-big">unlikely to be stocked with basics such as toilet paper or soap</span>.</p>
                    </div>

                    <div class="scrolly-caption-box" data-annotation-label="unhygenic-toilets" style="opacity: 0">
                        <p>Unsurprising, then, that our CJs found the state of the toilets to be <span class="scrolly-secondary scrolly-fw-500 scrolly-big">very unhygienic</span>, with urine or feacal matter on the seats in 13 clinics, including nine in Limpopo.</p>
                    </div>

                    <div class="scrolly-annotation-inner">

                        <div class="scrolly-row">
                            <div class="scrolly-col">
                                <div class="scrolly-chart-container">
                                    <canvas id="fs"></canvas>
                                    <div class="scrolly-chart-label-container">
                                        <div class="scrolly-chart-label">Free State</div>
                                    </div>
                                </div>
                            </div>
                            <div class="scrolly-col">
                                <div class="scrolly-chart-container">
                                    <canvas id="lp"></canvas>
                                    <div class="scrolly-chart-label-container">
                                        <div class="scrolly-chart-label">Limpopo</div>
                                    </div>
                                </div>
                            </div>
                            <div class="scrolly-col">
                                <div class="scrolly-chart-container">
                                    <canvas id="kzn"></canvas>
                                    <div class="scrolly-chart-label-container">
                                        <div class="scrolly-chart-label">KZN</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>

                </div>

                <div class="scrolly-annotation scrolly-chart-2">

                    <div class="scrolly-caption-box" data-annotation-label="gender-breakdown" style="opacity: 0">
                        <p>Interviewees were fairly <span class="scrolly-secondary scrolly-fw-500 scrolly-big">evenly split between age and gender</span>.</p>
                    </div>
                   
                    <div class="scrolly-annotation-inner">
                        <canvas id="population-chart"></canvas>
                    </div>
                </div>

                <div class="scrolly-annotation scrolly-chart-3">

                    <div class="scrolly-caption-box" data-annotation-label="queues" style="opacity: 0">
                        <p>In addition to the basic state of hygiene, in some larger facilities our reporters witnessed <span class="scrolly-secondary scrolly-fw-500 scrolly-big">people queuing for up to an hour</span> to use the bathroom.</p>
                    </div>

                    <div class="scrolly-caption-box" data-annotation-label="unsafe" style="opacity: 0">
                        <p>No wonder then that so many people told us that they <span class="scrolly-secondary scrolly-fw-500 scrolly-big">didn’t feel safe using the toilets.</span></p>
                    </div>

                    <div class="scrolly-caption-box" data-annotation-label="women-unsafe" style="opacity: 0">
                        <p>This included <span class="scrolly-secondary scrolly-fw-500 scrolly-big">more than half of all women interviewed</span>. Surprisingly, <span class="scrolly-secondary scrolly-fw-500">two thirds of 18-25-year-olds</span> said they didn’t feel safe, compared to around <span class="scrolly-secondary scrolly-fw-500">40% of those aged 26-40 or older than 60</span>.</p>
                    </div>

                    <div class="scrolly-caption-box" data-annotation-label="return-visits" style="opacity: 0">
                        <p>Apart from the obvious implications to health, and our expectations of germ control in a medical centre, <span class="scrolly-secondary scrolly-fw-500 scrolly-big">83 patients</span> we spoke to told us that the state of the bathrooms <span class="scrolly-secondary scrolly-fw-500 scrolly-big">put them off visiting again</span>. The implications of this - people avoiding primary health care facilities - are severe.</p>
                    </div>

                    <div class="scrolly-annotation-inner">
                        <canvas id="queues-chart"></canvas>
                    </div>

                </div>

               



            </div>
        </div>

        <div class="scrolly-sections-container">

            <div class="scrolly-section" data-background="img/toilets1.jpg" data-section-label="start">
                <div class="scrolly-slide-inner">
                    <div class="scrolly-caption-box">
                        <h1 class="scrolly-secondary">What we did</h1>
                        <p>To better understand the state of <span class="scrolly-secondary scrolly-fw-500">sanitation in
                                our primary healthcare system</span>, we asked our network of <span
                                class="scrolly-secondary scrolly-fw-500">community journalists</span> to tell us what the
                            bathrooms are like in their local clinics. We also also asked them to interview people who
                            had recently used the clinics.</p>
                    </div>
                </div>
            </div>

            <div class="scrolly-section" data-background="img/map-base.jpg" data-section-label="they-visited">
                <div class="scrolly-slide-inner">
                    <div class="scrolly-caption-box">
                        <p>They visited <span class="scrolly-secondary scrolly-fw-500 scrolly-big">31 clinics</span><br />in <span class="scrolly-secondary scrolly-fw-500 scrolly-big">3 provinces</span></p>
                    </div>
                </div>
            </div>

            <div class="scrolly-section" data-background="img/map.jpg" data-section-label="313-users">
                <div class="scrolly-slide-inner">
                    <div class="scrolly-caption-box">
                        <p>And interviewed<br /><span class="scrolly-secondary scrolly-fw-500 scrolly-big">313 recent users</span><br />of those clinics.</p>
                    </div>
                </div>
            </div>

            <div class="scrolly-section" data-background="img/toilets-gender1.jpg" data-section-label="gender-breakdown"></div>
            

            <!-- ACCESS -->

            <div class="scrolly-section" data-background="img/outdoor-toilets.jpg" data-section-label="outdoor-facilities"></div>

            <div class="scrolly-section" data-background="img/pit-latrine1.jpg" data-section-label="pit-latrine">
                <div class="scrolly-slide-inner">
                    <div class="scrolly-caption-box scrolly-caption-box-overlay">
                        <p><span class="scrolly-secondary scrolly-fw-500 scrolly-big">Seven</span> clinics in Limpopo<br/>had some sort of <span class="scrolly-secondary scrolly-fw-500 scrolly-big">pit latrine</span>.</p>
                    </div>
                </div>
            </div>

            <div class="scrolly-section" data-background="img/disabled.jpg" data-section-label="disabled-access"></div>

            <!-- BROKEN TOILETS -->

            <div class="scrolly-section" data-background="img/disabled.jpg" data-section-label="broken-toilets"></div>

            <div class="scrolly-section" data-background="img/broken-toilets.jpg" data-section-label="broken-toilets-kzn-lp">
                <div class="scrolly-slide-inner">
                    <div class="scrolly-caption-box scrolly-caption-box-overlay">
                        <p>Broken bathrooms were experienced much more in <span class="scrolly-secondary scrolly-fw-500">KZN</span> and <span class="scrolly-secondary scrolly-fw-500">Limpopo</span> than in the Free State.</p>
                    </div>
                </div>
            </div>

            <div class="scrolly-section" data-background="img/broken-toilets.jpg" data-section-label="not-stocked"></div>

            <div class="scrolly-section" data-background="img/no-toilet-paper.jpg" data-section-label="no-toilet-paper"></div>

            <div class="scrolly-section" data-background="img/no-toilet-paper.jpg" data-section-label="no-sanitiser"></div>

            <div class="scrolly-section" data-background="img/dirty-toilets.jpg" data-section-label="unhygenic-toilets"></div>

            <div class="scrolly-section" data-background="img/queue.jpg" data-section-label="queues"></div>

            <!--SAFETY-->

            <div class="scrolly-section" data-background="img/no-lock.jpg" data-section-label="unsafe"></div>

            <div class="scrolly-section" data-background="img/no-lock.jpg" data-section-label="women-unsafe"></div>

            <div class="scrolly-section" data-background="img/people1.jpg" data-section-label="return-visits"></div>

            <!--CONCLUSION-->

            <div class="scrolly-section" data-background="img/toilets1.jpg" data-section-label="conclusion">
                <div class="scrolly-slide-inner">
                    <div class="scrolly-caption-box">
                        <p>And all for the sake of a <span class="scrolly-secondary scrolly-fw-500 scrolly-big">usable bathroom</span>.</p>
                    </div>
                </div>
            </div>

            <div class="scrolly-section" data-background="img/toilets1.jpg" data-section-label="conclusion2"></div>
            <div class="scrolly-section" data-background="img/toilets1.jpg" data-section-label="end"></div>


        </div>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.10.4/gsap.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.10.4/ScrollTrigger.min.js"></script>
        <script>

            DEBUG = false;
            

            function updateBackgroundImage(src) {
                const bgImage = document.querySelector('.scrolly-bg-image');
            
                const overlayImage = document.createElement('img');
                overlayImage.src = src;
                overlayImage.classList.add('scrolly-bg-image');
                overlayImage.style.position = 'absolute';
                overlayImage.style.top = '0';
                overlayImage.style.left = '0';
                overlayImage.style.width = '100%';
                overlayImage.style.height = '100%';
                overlayImage.style.objectFit = 'cover';
                overlayImage.style.zIndex = '-2';
                overlayImage.style.opacity = '0';
            
                bgImage.parentElement.appendChild(overlayImage);
            
                gsap.to(overlayImage, {
                    opacity: 1,
                    duration: 0.5,
                    onComplete: () => {
                        bgImage.remove();
                    }
                });
            }
            
            gsap.registerPlugin(ScrollTrigger);
            
            document.querySelectorAll('.scrolly-section').forEach((section, index) => {
                const background = section.getAttribute('data-background');

                // DEBUG
                const section_label = section.getAttribute('data-section-label');
                
                if(DEBUG == true) {
                    let label = section.appendChild(document.createElement('div'));
                    label.classList.add('scrolly-section-label');
                    label.textContent = section_label;
                    section.classList.add('debug');
                }
            
                ScrollTrigger.create({
                    trigger: section,
                    start: 'top center',
                    onEnter: () => {
                        updateBackgroundImage(background);
                    },
                    onLeaveBack: () => {
                        const prevSection = document.querySelectorAll('.scrolly-section')[index - 1];
                        const prevBackground = prevSection ? prevSection.getAttribute('data-background') : background;
                        updateBackgroundImage(prevBackground);
                    }
                });
            });

            gsap.registerPlugin(ScrollTrigger);

            const background = document.querySelector('.scrolly-background');

            ScrollTrigger.create({
                trigger: ".scrolly-section[data-section-label='start']",
                start: "top top",
                endTrigger: ".scrolly-section[data-section-label='end']",
                end: "bottom bottom",
                toggleClass: { targets: background, className: 'fixed' },
            });

            /// CUSTOMISATION STARTS HERE

            /// PINS
            
            ScrollTrigger.create({
                trigger: ".scrolly-section[data-section-label='conclusion']",
                pin: true,
                start: "center center",
                endTrigger: ".scrolly-section[data-section-label='end']",
                end: 'top top',
                pinSpacing: false
            });


            /// ANNOTATIONS

            // CHARTS

            // POPULATION CHART

            var data = {
                labels: ["18-25", "26-40", "41-60", "60+"],
                datasets: [
                    {
                        label: "Female",
                        stack: "Stack 0",
                        backgroundColor: "#FFC107",
                        data: [0, 0, 0, 0].map((k) => -k),
                    },
                    {
                        label: "Male",
                        stack: "Stack 0",
                        backgroundColor: "#FF5722",
                        data: [0, 0, 0, 0],
                    },
                ],
            };
            
            var options = {
                indexAxis: 'y',
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: (c) => {
                                const value = Number(c.raw);
                                const positiveOnly = value < 0 ? -value : value;
                                return `${c.dataset.label}: ${positiveOnly.toString()}`;
                            },
                        },
                    },
                    legend: false,
                    annotation: {
                        annotations: {
                            diagonalLine1: {
                                type: 'line',
                                xMin: 10,
                                yMin: '18-25',
                                xMax: 50,
                                yMax: '18-25', 
                                borderColor: 'white',
                                borderWidth: 1,
                                opacity: 0

                            },
                            textAnnotation1: {
                                type: 'label',
                                xValue: 60,
                                yValue: '18-25',
                                content: ['Male'],
                                color: 'rgba(255, 255, 255, 0.9)',
                                font: {
                                    size: 14,
                                    weight: 'bold',
                                },
                                position: {
                                    x: 'center',
                                    y: 'center'
                                },
                                opacity: 0
                            },
                            diagonalLine2: {
                                type: 'line',
                                xMin: -10,
                                yMin: '41-60',
                                xMax: -50,
                                yMax: '41-60', 
                                borderColor: 'white',
                                borderWidth: 1,
                                opacity: 0
                            },
                            textAnnotation2: {
                                type: 'label',
                                xValue: -60,
                                yValue: '41-60',
                                content: ['Female'],
                                color: 'rgba(255, 255, 255, 0.9)',
                                font: {
                                    size: 14,
                                    weight: 'bold',
                                },
                                position: {
                                    x: 'center',
                                    y: 'center'
                                },
                                opacity: 0
                            },
                        }
                    }
                },
                scales: {
                    x: {
                        min: -80,
                        max: 80,
                        ticks: {
                            stepSize: 20,
                            callback: (v) => (v < 0 ? -v : v),
                            color: 'rgba(255,255,255,1)',
                        },
                        border: {
                            color: 'rgba(255,255,255,1)',
                            width: 2,
                        },
                        grid: {
                            color: 'rgba(255,255,255,0.2)',
                            lineWidth: 1,
                            borderDash: [5, 5],
                        },
                        title: {
                            display: true,
                            text: 'Population Count',
                            color: 'rgba(255,255,255,1)',
                        },
                    },
                    y: {
                        grid: {
                            display: false,
                        },
                        ticks: {
                            color: 'rgba(255,255,255,1)',
                        },
                        border: {
                            color: 'rgba(255,255,255,1)',
                            width: 2,
                        },
                        title: {
                            display: true,
                            text: 'Age Groups',
                            color: 'rgba(255,255,255,1)',
                        },
                    },
                },
            };
            
            const population_ctx = document.getElementById('population-chart').getContext('2d');
            const population_chart = new Chart('population-chart', {
                type: 'bar',
                options: options,
                data: data,
            });
            

            // WAITING TIME CHART

            
            const queues_ctx = document.getElementById('queues-chart').getContext('2d');
            const queues_chart = new Chart(queues_ctx, {
                type: 'bar',
                data: {
                    labels: ['21-50', '51-70', '71-100', '100+'],
                    datasets: [
                        {
                            label: '0-10 mins',
                            data: [1, 1, 3, 0],
                            backgroundColor: 'rgba(75, 192, 192, 1)',
                            borderColor: 'rgba(75, 192, 192, 1)',
                            borderWidth: 0
                        },
                        {
                            label: '10-20 mins',
                            data: [6, 10, 8, 11],
                            backgroundColor: '#FF5722',
                            borderColor: '#FF5722',
                            borderWidth: 0
                        },
                        {
                            label: '20-40 mins',
                            data: [2, 2, 2, 10],
                            backgroundColor: 'rgba(255, 159, 64, 1)',
                            borderColor: 'rgba(255, 159, 64, 1)',
                            borderWidth: 0
                        },
                        {
                            label: '40-60 mins',
                            data: [0, 1, 1, 2],
                            backgroundColor: 'rgba(54, 162, 235, 1)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                            borderWidth: 0
                        }
                    ]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Number of People',
                                color: 'rgba(255,255,255,1)'
                            },
                            border: {
                                color: 'rgba(255,255,255,1)',
                                width: 2,
                            },
                            grid: {
                                color: 'rgba(255,255,255,0.2)',
                                lineWidth: 1,
                                borderDash: [5, 5],
                            },
                            ticks: {
                                color: 'rgba(255,255,255,1)',
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'People Count Range',
                                color: 'rgba(255,255,255,1)',
                            },
                            border: {
                                color: 'rgba(255,255,255,1)',
                                width: 2,
                            },
                            grid: {
                                color: 'rgba(255,255,255,0.2)',
                                lineWidth: 1,
                                borderDash: [5, 5],
                            },
                            ticks: {
                                color: 'rgba(255,255,255,1)',
                            }
                        }
                    },
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                color: 'rgba(255,255,255,1)',
                            }
                        },
                        title: {
                            display: false
                        }
                    }
                }
            });


            // PROVINCE CHARTS

            const doughnut_chart_options = {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: {
                        display: false
                    },
                    aannotation: {
                        annotations: {
                            textAnnotation: {
                                type: 'label',
                                xValue: '50%', 
                                yValue: '90%', 
                                content: ['Important Segment'],
                                color: 'rgba(255, 255, 255, 0.9)',
                                font: {
                                    size: 14,
                                    weight: 'bold',
                                },
                                padding: 6,
                                borderRadius: 4
                            }
                        }
                    }
                },
                borderWidth: 0
            };

            const fs_ctx = document.getElementById('fs').getContext('2d');
            const fs = new Chart(fs_ctx, {
                type: 'doughnut',
                options: doughnut_chart_options,
                data: {
                    labels: ['Both', 'Inside', 'Outside'],
                    datasets: [{
                        data: [0, 0, 0],
                        backgroundColor: ['#999999', '#ffd06c', '#ff3d3b']
                    }]
                }
            });

            const lp_ctx = document.getElementById('lp').getContext('2d');
            const lp = new Chart(lp_ctx, {
                type: 'doughnut',
                options: doughnut_chart_options,
                data: {
                    labels: ['Both', 'Inside', 'Outside'],
                    datasets: [{
                        data: [0, 0, 0],
                        backgroundColor: ['#999999', '#ffd06c', '#ff3d3b']
                    }]
                }
            });

            const kzn_ctx = document.getElementById('kzn').getContext('2d');
            const kzn = new Chart(kzn_ctx, {
                type: 'doughnut',
                options: doughnut_chart_options,
                data: {
                    labels: ['Both', 'Inside', 'Outside'],
                    datasets: [{
                        data: [0, 0, 0],
                        backgroundColor: ['#999999', '#ffd06c', '#ff3d3b']
                    }]
                }
            });

            // CHART DATA

            const female_age_distribution = [21, 57, 36, 33].map((k) => -k);
            const male_age_distribution = [27, 55, 45, 38];

            const fs_inside_outside = [0, 20, 0];
            const lp_inside_outside = [8, 0, 12];
            const kzn_inside_outside = [9, 7, 4];

            const fs_disabled_access = [0, 4,16];
            const lp_disabled_access = [0, 16, 6];
            const kzn_disabled_access = [0, 16, 4];

            const fs_unusable_toilets = [0, 44, 65];
            const lp_unusable_toilets = [0, 6, 95];
            const kzn_unusable_toilets = [0, 27, 76];

            const fs_toilet_paper = [0, 3, 7];
            const lp_toilet_paper = [0, 0, 10];
            const kzn_toilet_paper = [0, 3, 7];

            // ADD: TOILET PAPER BREAKDOWN BY GENDER

            const fs_no_sanitiser = [0, 6, 14];
            const lp_no_sanitiser = [0, 2, 18];
            const kzn_no_sanitiser = [0, 7, 13];

            const fs_dirty_toilets = [2, 3, 0];
            const lp_dirty_toilets = [9, 8, 3];
            const kzn_dirty_toilets = [2, 4, 2];

            // ADD: QUEUE

            // ADD: BATHROOM USAGE

            // ADD: SAFETY

            // ADD: SAFETY FEMALE AGE

            // ADD: CLINIC VISIT




            function updateChartLegend(legend) {
                const legendContainer = document.querySelector('.scrolly-chart-legend');
                legendContainer.innerHTML = '';
                legend.forEach((item) => {
                    const legendItem = document.createElement('div');
                    legendItem.classList.add('scrolly-legend-item');
                    legendItem.innerHTML = `
                        <div class="scrolly-legend-color" style="background-color: ${item.color};"></div>
                        <div class="scrolly-legend-text">${item.text}</div>
                    `;
                    legendContainer.appendChild(legendItem);
                });
            }

            function pinChartTitle(label) {
                gsap.to('.scrolly-caption-box[data-annotation-label]', { opacity: 0, ease: "none" });
                gsap.fromTo(
                    `.scrolly-caption-box[data-annotation-label='${label}']`,
                    { opacity: 0 },
                    { opacity: 1, ease: "none" }
                );
            }

            function titleFadeIn(label, trigger) {
                gsap.fromTo(
                `.scrolly-caption-box[data-annotation-label='${label}']`,
                { opacity: 0 },
                { 
                    opacity: 1, 
                    ease: "none",
                    scrollTrigger: {
                        trigger: `.scrolly-section[data-section-label='${label}']`,
                        start: "top bottom",
                        end: "top center",
                        scrub: true
                    }
                }
            );
            }

            function titleFadeOut(label, trigger) {
                gsap.to(
                `.scrolly-caption-box[data-annotation-label='${label}']`,
                { 
                    opacity: 0,
                    ease: "none",
                    scrollTrigger: {
                        trigger: `.scrolly-section[data-section-label='${trigger}']`,
                        start: "top 50%",
                        end: "top center",
                        scrub: true
                    }
                });
            }

            function fadeOutChart(label, trigger) {
                gsap.to(
                    `.${label} .scrolly-annotation-inner`,
                    { 
                        opacity: 0,
                        ease: "none",
                        scrollTrigger: {
                            trigger: `.scrolly-section[data-section-label='${trigger}']`,
                            start: "top 50%",
                            end: "top center",
                            scrub: true
                        }
                    });
            }

            // TITLES INS AND OUTS

            titleFadeIn('gender-breakdown', 'gender-breakdown');

            titleFadeOut('gender-breakdown', 'outdoor-facilities');

            titleFadeIn('outdoor-facilities', 'outdoor-facilities');

            titleFadeOut('outdoor-facilities', 'disabled-access');

            titleFadeIn('disabled-access', 'disabled-access');
            
            titleFadeOut('disabled-access', 'broken-toilets');

            titleFadeIn('broken-toilets', 'broken-toilets');

            titleFadeOut('broken-toilets', 'not-stocked');

            titleFadeIn('not-stocked', 'not-stocked');

            titleFadeOut('not-stocked', 'unhygenic-toilets');

            titleFadeIn('unhygenic-toilets', 'unhygenic-toilets');

            titleFadeOut('unhygenic-toilets', 'queues');

            titleFadeIn('queues', 'queues');

            titleFadeOut('queues', 'unsafe');

            titleFadeIn('unsafe', 'unsafe');

            titleFadeOut('unsafe', 'women-unsafe');

            titleFadeIn('women-unsafe', 'women-unsafe');

            titleFadeOut('women-unsafe', 'return-visits');

            titleFadeIn('return-visits', 'return-visits');

            titleFadeOut('return-visits', 'conclusion');





            // CHART ANIMATION

            


            gsap.timeline({
                scrollTrigger: {
                    trigger: ".scrolly-section[data-section-label='gender-breakdown']",
                    start: "top bottom",
                    end: "top center",
                    scrub: true
                }
            })
                .fromTo(
                    ".scrolly-chart-2",
                    { opacity: 0 },
                    { opacity: 1, ease: "none" }
                )
                .to(population_chart.data.datasets[0].data, { endArray: female_age_distribution, ease: "none", onUpdate: function () { population_chart.update(); } }, 0)
                .to(population_chart.data.datasets[1].data, { endArray: male_age_distribution, ease: "none", onUpdate: function () { population_chart.update(); } }, 0)
                .add(() => {
                    // Set annotation opacity to 1 after the chart animation completes
                    population_chart.options.plugins.annotation.annotations.diagonalLine1.opacity = 1;
                    population_chart.options.plugins.annotation.annotations.textAnnotation1.opacity = 1;
                    population_chart.options.plugins.annotation.annotations.diagonalLine2.opacity = 1;
                    population_chart.options.plugins.annotation.annotations.textAnnotation2.opacity = 1;
                    population_chart.update();
                },1);
                
            fadeOutChart('scrolly-chart-2', 'outdoor-facilities');
                       

            

            // PROVINCE BREAKDOWN CHART ANIMATION

           // INSIDE/OUTSIDE
           
            
           
            
            
            gsap
            .timeline({
                scrollTrigger: {
                    trigger: ".scrolly-section[data-section-label='outdoor-facilities']",
                    start: "top bottom",
                    end: "top center",
                    scrub: true
                }
            })
            .fromTo(
                ".scrolly-chart-1",
                { opacity: 0 },
                { opacity: 1, ease: "none" }
            )
            .to(fs.data.datasets[0].data, { endArray: fs_inside_outside, ease: "none", onUpdate: function () { fs.update(); } }, 0)
            .to(lp.data.datasets[0].data, { endArray: lp_inside_outside, ease: "none", onUpdate: function () { lp.update(); } }, 0)
            .to(kzn.data.datasets[0].data, { endArray: kzn_inside_outside, ease: "none", onUpdate: function () { kzn.update(); } }, 0);
                

            
            

            // DISABLED

            

            gsap
            .timeline({
                scrollTrigger: {
                    trigger: ".scrolly-section[data-section-label='disabled-access']",
                    start: "top center",
                    end: "top top",
                    scrub: true
                }
            })
            .to(fs.data.datasets[0].data, { endArray: fs_disabled_access, ease: "none", onUpdate: function () { fs.update(); } }, 0)
            .to(lp.data.datasets[0].data, { endArray: lp_disabled_access, ease: "none", onUpdate: function () { lp.update(); } }, 0)
            .to(kzn.data.datasets[0].data, { endArray: kzn_disabled_access, ease: "none", onUpdate: function () { kzn.update(); } }, 0);

            

            
            // UNUSABLE

            


            gsap
            .timeline({
                scrollTrigger: {
                    trigger: ".scrolly-section[data-section-label='broken-toilets']",
                    start: "top center",
                    end: "top top",
                    scrub: true
                }
            })
            .to(fs.data.datasets[0].data, { endArray: fs_unusable_toilets, ease: "none", onUpdate: function () { fs.update(); } }, 0)
            .to(lp.data.datasets[0].data, { endArray: lp_unusable_toilets, ease: "none", onUpdate: function () { lp.update(); } }, 0)
            .to(kzn.data.datasets[0].data, { endArray: kzn_unusable_toilets, ease: "none", onUpdate: function () { kzn.update(); } }, 0);
                
            

            


            // TOILET PAPER

            gsap
            .timeline({
                scrollTrigger: {
                    trigger: ".scrolly-section[data-section-label='no-toilet-paper']",
                    start: "top center",
                    end: "top top",
                    scrub: true
                }
            })
            .to(fs.data.datasets[0].data, { endArray: fs_toilet_paper, ease: "none", onUpdate: function () { fs.update(); } }, 0)
            .to(lp.data.datasets[0].data, { endArray: lp_toilet_paper, ease: "none", onUpdate: function () { lp.update(); } }, 0)
            .to(kzn.data.datasets[0].data, { endArray: kzn_toilet_paper, ease: "none", onUpdate: function () { kzn.update(); } }, 0);
            

            // SANITISER

            gsap
            .timeline({
                scrollTrigger: {
                    trigger: ".scrolly-section[data-section-label='no-sanitiser']",
                    start: "top center",
                    end: "top top",
                    scrub: true
                }
            })
            .to(fs.data.datasets[0].data, { endArray: fs_no_sanitiser, ease: "none", onUpdate: function () { fs.update(); } }, 0)
            .to(lp.data.datasets[0].data, { endArray: lp_no_sanitiser, ease: "none", onUpdate: function () { lp.update(); } }, 0)
            .to(kzn.data.datasets[0].data, { endArray: kzn_no_sanitiser, ease: "none", onUpdate: function () { kzn.update(); } }, 0);
                

            

            // DIRTY TOILETS

            gsap
            .timeline({
                scrollTrigger: {
                    trigger: ".scrolly-section[data-section-label='unhygenic-toilets']",
                    start: "top center",
                    end: "top top",
                    scrub: true
                }
            })
            .to(fs.data.datasets[0].data, { endArray: fs_dirty_toilets, ease: "none", onUpdate: function () { fs.update(); } }, 0)
            .to(lp.data.datasets[0].data, { endArray: lp_dirty_toilets, ease: "none", onUpdate: function () { lp.update(); } }, 0)
            .to(kzn.data.datasets[0].data, { endArray: kzn_dirty_toilets, ease: "none", onUpdate: function () { kzn.update(); } }, 0);
                
            
            
            // FADE OUT PROVINCE CHART

            fadeOutChart('scrolly-chart-1', 'queues');
            

            // QUEUES CHART

            gsap
            .timeline({
                scrollTrigger: {
                    trigger: ".scrolly-section[data-section-label='queues']",
                    start: "top bottom",
                    end: "top center",
                    scrub: true
                }
            })
            .fromTo(
                ".scrolly-chart-3",
                { opacity: 0 },
                { opacity: 1, ease: "none" }
            );

            fadeOutChart('scrolly-chart-3', 'unsafe');

            // SAFETY



            
                


        </script>
    </div>

    <!-- END SCROLLY -->





</body>

</html>